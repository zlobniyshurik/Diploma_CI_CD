# SETUP_CLUSTER

## Выполняемые действия

1. Вычищаются все анонимные пользователи

2. **`root`** учётка получает пароль, а доступ к ней ограничивается доступом из подсети "серых" IP,  серверов нашего домена и localhost'ом.

3. Вычисляются **`server-id`** для каждой ноды.  
Грубо говоря, в качестве ID берётся номер ноды из её названия, то есть, нода **db0012345.mydomain.tld** получит **`server-id`=12345**

4. Полученные **`server-id`** вносятся в конфигурационные файлы **/etc/my.cnf.d/server.cnf** для каждой ноды.

5. Собственно, настраивается репликация между **master**-нодой и **slave**-нодами.

На выходе получаем запущенный кластер с работающей репликацией и настроенной **`root`**-учёткой DB.

## Переменные

***defaults/main.yml***
| Имя переменной | Описание | Возможные значения | Значение по умолчанию |
| :--- | :--------- | :--- | :---: |
| **cluster_init_root_password** | Исходный пароль учётки `root` | *Обычно пароль пуст* | **""** |
| **cluster_network** | Подсеть в MySQL формате | Например, **192.168.1.%** или **10.0.%**| **172.16.%** |
| **cluster_repl_pass** | Пароль к служебной учетке для репликации | | **resu_acilper** |
| **cluster_repl_user** | Имя служебной учётки для репликации|  |**replica_user**|
| **cluster_root_password** | Пароль к `root`-учётке БД после настройки кластера || **StrongPassword#100500**|
